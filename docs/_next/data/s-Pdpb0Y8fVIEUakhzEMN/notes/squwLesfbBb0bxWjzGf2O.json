{"pageProps":{"note":{"id":"squwLesfbBb0bxWjzGf2O","title":"Ssh","desc":"","updated":1630089833338,"created":1614746902412,"custom":{},"fname":"unix.cli.ssh","type":"note","vault":{"fsPath":"../main/tech","name":"tech"},"contentHash":"db4f49f08579801bdf9c201766ade4af","links":[],"anchors":{"ssh-key":{"type":"header","text":"SSH Key","value":"ssh-key","line":11,"column":0,"depth":1},"components":{"type":"header","text":"Components","value":"components","line":12,"column":0,"depth":2},"public-key":{"type":"header","text":"Public key","value":"public-key","line":15,"column":0,"depth":3},"private-key":{"type":"header","text":"Private key","value":"private-key","line":23,"column":0,"depth":3},"ssh-agent":{"type":"header","text":"SSH Agent","value":"ssh-agent","line":32,"column":0,"depth":2},"agent-forwarding":{"type":"header","text":"Agent Forwarding","value":"agent-forwarding","line":49,"column":0,"depth":3},"debugging":{"type":"header","text":"Debugging","value":"debugging","line":56,"column":0,"depth":2},"tunneling":{"type":"header","text":"Tunneling","value":"tunneling","line":70,"column":0,"depth":2},"config":{"type":"header","text":"Config","value":"config","line":79,"column":0,"depth":2}},"children":[],"parent":"2ICa3y8o1jvOO8ahBentp","data":{}},"body":"<h1 id=\"ssh\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#ssh\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Ssh</h1>\n<h1 id=\"ssh-key\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#ssh-key\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>SSH Key</h1>\n<h2 id=\"components\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#components\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Components</h2>\n<ul>\n<li>Each SSH key pair has 2 components: public key and private key</li>\n<li>They are both created with <code>ssh-keygen</code> </li>\n</ul>\n<h3 id=\"public-key\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#public-key\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Public key</h3>\n<ul>\n<li>Public key is copied to the SSH server so it knows it can trust the user with the corresponding private key when it tries to connect via SSH</li>\n<li>Anyone that has the public key is able to encrypt the data in such a way that only the bearer of the private key can decrypt it. </li>\n<li>Once an SSH server receives the public key from a user, it marks the key as trustworthy and is moved to the <code>authorized_keys</code> file.</li>\n<li><code>ssh-copy-id</code> allows us to copy an SSH key from our local machine to a server to be used as an authorized key, allowing s the SSH client to login without password\n<ul>\n<li>What it does is it assembles a list of one or more fingerprints, and tries to log in with each key. It then makes a list of all the keys that failed login, and enables logins with those keys on the remote server (by adding them to the remote's <code>authorized_keys</code> file).</li>\n</ul>\n</li>\n<li>Public keys are stored on SSH clients </li>\n</ul>\n<h3 id=\"private-key\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#private-key\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Private key</h3>\n<ul>\n<li>Considered proof of the user's identity, and only if the private key corresponds to the public key will the user be authenticated</li>\n<li>Because they are used for authentication, they are called identity keys</li>\n<li>The private key is stored on the SSH server</li>\n<li>When we open the private key, what we see is its encrypted form. To decrypt it, we need to enter the password that we created with <code>ssh-keygen</code>.\n<ul>\n<li>Therefore, without the password, the private key is useless.</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"ssh-agent\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#ssh-agent\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>SSH Agent</h2>\n<p>ssh-agent stores unencrypted private keys in memory, allowing us to login without entering our password each time.</p>\n<ul>\n<li>Therefore, ssh-agent is a form of Single-Sign on (SSO)</li>\n<li>Without ssh-agent, upon entering the password, the decrypted key is stored in program memory (which is associated with a process (PID)). However, the SSH client process cannot be used to store the decrypted key, since the process is terminated once the remote login session has ended. This is why we use <code>ssh-agent</code></li>\n</ul>\n<p><code>ssh-agent</code> works by creating a socket then checks for connections from ssh.</p>\n<ul>\n<li>anyone who is able to connect to this socket can also connect to the ssh-agent.</li>\n<li>upon starting, the agent creates a new directory in <code>/tmp</code> that determines permissions.</li>\n</ul>\n<p>On most Linux systems, ssh-agent is automatically configured and run at login. </p>\n<p>On the server side, <code>PubkeyAuthentication</code> must be enabled in the <code>ssh_config</code> file to allow these key-based logins. </p>\n<p>we can use <code>ssh-add</code> tool to add identities to the agent.</p>\n<ul>\n<li>running <code>ssh-add</code> without args will add the default private keys to the agent (<code>~/.ssh/id_rsa</code>, <code>~/.ssh/id_dsa</code> etc.)</li>\n<li><code>ssh-add -l</code> will list out the private keys accessible to the agent</li>\n</ul>\n<h3 id=\"agent-forwarding\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#agent-forwarding\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Agent Forwarding</h3>\n<p>Agent forwarding is a mechanism that gives an SSH server access to the SSH client's <code>ssh-agent</code>, allowing it to use it as if it were local.\nTo use agent forwarding, the <code>ForwardAgent</code> option must be set to yes on the client </p>\n<ul>\n<li>This allows us to execute commands on the server we SSHed into and have access to keys stored in <code>ssh-agent</code>. \n<ul>\n<li>ex. if we are using keys to interact with Github (instead of entering password each time), we would be able to access them from the server. </li>\n<li>However, there is an implication of this, which is that we would not be able to run these commands as cron jobs on the server. Once our SSH connection ends, the the server no longer has access to <code>ssh-agent</code>, so it cannot use the private key.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"debugging\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#debugging\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Debugging</h2>\n<ul>\n<li>\n<p>check client logs with <code>ssh -vvv &#x3C;user>@&#x3C;host></code></p>\n</li>\n<li>\n<p>check server logs at <code>/var/log/auth.log</code></p>\n</li>\n<li>\n<p>on server, try editing <code>/etc/ssh/sshd_config</code>, changing: </p>\n<ol>\n<li><code>PasswordAuthentication yes</code></li>\n<li><code>PermitRootLogin yes</code></li>\n</ol>\n<ul>\n<li>restart sshd <code>service sshd restart</code></li>\n<li>on client, run <code>ssh-copy-id -i &#x3C;remote-user>@&#x3C;remote-ip></code></li>\n<li>on host, revert the <code>sshd_config</code> options to their prior state</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"tunneling\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#tunneling\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Tunneling</h2>\n<ul>\n<li>In order to tunnel, we need to set up a protocol. SSH is an example of such a protocol, where the receiver of the SSH command must have an SSH server running so that it may intercept the SSH message, and interpret it and enable the SSH connection. </li>\n</ul>\n<hr>\n<p>an OS can be preconfigured to enable SSH, so that it can be SHHed into the first time it is turned on.</p>\n<hr>\n<h2 id=\"config\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#config\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Config</h2>\n<p>Client config (~/.ssh/config)\n<a href=\"https://gravitational.com/blog/ssh-config/\">good resource with lots of info</a></p>","noteIndex":{"id":"olZIVfSs2uLLr3BppFh4K","title":"Root","desc":"","updated":1618676699718,"created":1615482407722,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"../main/tech","name":"tech"},"contentHash":"777fb4dab9bcf63cbfe772245d7e4871","links":[],"anchors":{"digital-garden":{"type":"header","text":"Digital Garden","value":"digital-garden","line":8,"column":0,"depth":1}},"children":["zFMjbn3xihVNHjUIdZCD1","IK6NOKemuDjhfstJBovKL","RS8qp1GxwtiJopCUHTTtq","ZaTr28eWk1DrXOEsc1YVb","Vi0WYVLZunVM9iR8XZJn3","ngAbg7gluvbt1bY1UIRsi","RCPPXSakm5TvKka8kOmVp","MPx8ykTP57I40WTZvTP7f","ZU5WmdTG1bHoE8RcmZXZG","jqWiyYJff92RjXuUQt9PQ","KihijM8OQvZ4pASkkhqzL","F9vyqvls3OBCujtukqKhy","facc2b01-755a-409f-99f6-57bef2d1501f","m5ov42Vm6mR7RQWTvl1NW","YYt62mSW964cwb5nP0hva","PZxxZ4iESzSlbbHJKxuAZ","UDu62Pa6BaRqlG8uGoMhy","nMCtMXVvjBsJk3iw1zoIO","ANfx9Z4a6ZA0uJuSHtbIJ","BkG557LKUYbH1DnxprEVT","1TaH8zDTM98FZ9SYaeXLM","dc79799f-a55d-48ab-a8be-c48adb1b19c0","f6feef57-b8f5-451f-a09a-7b63f6a07183","4sz47Y0LKs1Si73rWtyyh","5a9fb1df-478e-4687-9be0-5cb97e61ec57","1374e9e9-1cbc-4e1f-b1ca-66b8569533dd","f529cc34-aba0-45ca-ad7e-02ddda318941","0zcauha3il2NqtxZazIo7","9bbd6f68-03b2-41f4-92e4-2ca313e8b450","5a2ab598-fa7e-4471-8bda-9f5831b679ae","uV6w4mZPoohWyZV4Xaad0","RgE0mZLaUjPftFPZsiAoe","mytCOts26Pidush65tdRW","fwUzxfLSPMH1eL8oBoLWx","TbW7PM9bg1y5TGkiWwQ8b","xiSIDeEtIc8X0lpUQlppI","0jxgntiLNHWFuCbzqtFGF","GkdMprLUe4QQULBxmGN6V","4SYc6v5hxY5g6Ip6kjpwO","fqVQpS9FBiXgKsZX3R3sJ","L5JUZlGAGvTxrsEBB7DY8","963c4b54-02bd-4943-a15f-52cf59ffd0f4","TeTedoeS2LdHPR632eCpM","e65188a1-177e-4ab2-99f9-75f85d537621","fajYnbVhCRDi74xn0H30R","bArGdGwqo3iFkyKMyE7qR","4Dcp7gbEVoLLgfu7bXFai","5d700782-fb81-416e-83f9-5dd88260e350","zubgzhNFE6KlTgXcjTz6O","8lpdfWa0cbSq1XJQbcYcY","17I8ZksXvqCH1mRtZDjHp","kF916Ow84qpJJeMRkWMIo","tMLkLcrIHHBz56xVmBLkP","CSePBQ6q7qhowKESqVwt7","laZ4OfLhZNK1Kuy6GaWUr","z5IJblOknQhMzZ5QZh4ye","N36FHxfxzwJfxDY3miWyX","3bb25f58-2b50-4fa3-af55-48ea9f88a081","aOqNcxZh8qN4MoBJcvGTc","u93Rz4fEWGu6VBR30Zraf","9hjMHnKvYT4jLKvuDSXaV","LgW7mTIALODoXc54B3p6S","UYPxfHBFWX7fb6hHU5bB6","qxSOd6SPN8qf9ZUojVFDX","WQoMTf6VXBaxCgksXAVsj","2Mw4XgfyCHXHNOX5yoCIY","UFrwsXzC1yr7Ge8FF8Vbo","a8edc4ac-028b-40ec-872a-e4a005b04b2a","0XJqmcdtcMZu66glBI5O8","lK8r8BXS4ThiUTe4xKIZe","93de42ca-53ea-460a-baa7-b9ec5c47cb1e","Rxs2jaGpdFzqYtP7lAJFJ","aO8W81Z0PyIb6Hs7nOHPW","I01hENHnh8Tqu3Ok8sLzG","evqsPNutOaZ8hcBCqxFQu","zhhxcjZUHdU8uRLwGb9Zh","G1aFACZB2ooWGMGwyd3ZW","YWy1C4tgoaCcw1m8JJsr7","Szj3o5iaNxPpesiCqwrbu","XhvCDW3fIw6h6MhY5ticq","Q70g7SusFZBQXzkuQifv4","AzfWDH3wp7jFpL2EYxBcW","y0fwpZ9qMqirsLiFyOciU","ZF8xj8wwDUqKlrwTrCFZ1","tAJvhqhdfyZZa87QHq1TU","4hRmipi8lxpBLyzWu5JVB","iTg0C7QjvnmqBZeEigJNs","3babc3d2-79ae-470a-9c06-ab8bba2e684e","bF3UsMFya3fMeXWDspVov","ULkfbL9WpktbVYnzhl6Jw","PpNOO8JYWe6dM8wruSa7x","di40pCxDn7IiqE8lFdD46","rmW0mkerqV35I8QPji6lM","3IFIK1ByzeIxZCByryGLN","iImkYAKfkw3beAl6pLbDn","tho65KN0ZpjQlVvP1fEzM","ecDe8DNWrkeQTwpTEvHje","Yqhdd9mSJGN7OJOeyoSD2","NEhsoOfR7J6o01ielAuUm","Ws5tah8tpeyn9tK8VBTg8","Bqpifx2HX3vjLhX9yvhTV","gWAg15uBJgkS2B0wcpMAa","l7V3v2ep1YdDCt7DOr7Ci","yM2PJBdqJnHpD63cPA6sW","qn0bre7eLbi3QMbCfWkUi","fSu0KxFL41IRouotqmbHs","0gtg24Mj1a1bQFPRGQNlO","7iQPBMltLPLbFEz2qbjPu","yoh4pwoXcfELInGKRdYf6","dCGCWXgAmiOZXbdULT1m6","jMavlje07sNa6hSEIE8WA","Xxm0JE4dKHxrQAaZfzvxD","PAEBZCyFBZJyR7OoMZ41E","PQ6km8RgRCuyICBPOYz8f","2bhftt8rGuxYu4pFgNqru","hjYIZpHQWuXfeEoGeJEKW","K2M9bQqVq2eQfm29eslKL","X8obW1iKwYsvNgKWGyCzy","yJwSC7hqYIezTFHf5i0Ev","c4Z7ETcOHUILRMH32Sfjw","qiR6dIu857b9M9kTqjOyK","8vflbCVkwZtYcqdDDTNAz","Ku1OgHMhELajzo61Gx7ye","LUrfhDWo8wuwZu7CN9TV8","osu6JGOnvXJ5gt3tpqWZY","1a6173cd-cf13-4b34-a522-8350bf9a364f","ZgCUp366YrF2Tyky2NT73","S2sBltrPfd8a7ICuD7CuH","oWCuBXOg6JWfZzjmKxmNl","jOmhZ8ovLYTPbpM1vqSDx","FraC6xzLy1ei91l1ICyc9","6ceBas2RE9Q4787GDngH7","734cd78d-0bc9-426b-803d-1efc84dfffe5","k4Bb09px6r0FxIRs49SXV","oaG3H1S9IUBO644nGZigu","Ka7agQJkUMRSWN0uFdkWK","si3z090WsiLasMhJBa1Az","ljKAVERmdEiKLK9hXGKBm","LIcuGYV0DDt1VWbvH6Sed","MgUSrpNCIwDOW4fX3vPOF","bZumdyapJ2H0wWWOmJ45i","QHXEIyeZGIGMVi5Q52UWI","i5Fya3Vzzm0rBT0ctByuo"],"parent":null,"data":{},"body":"\n# Digital Garden\n\nThis Wiki of Personal Information is organized according to domains and their\nsub-domains, along with specific implementation of those domains.\n\nFor instance, Git itself is a domain. Sub-domains of Git, would be `commit`,\n`tags`, `reflog` etc. implementations of each of those could be `cli`, `strat`\n(strategies), `inner` etc.\n\nThe goal of the wiki is to present data in a manner that is from the perspective\nof a querying user. Here, a user is a programmer wanting to get key information\nfrom a specific domain. For instance, if a user wants to use postgres functions\nand hasn't done them in a while, they should be able to query\n`postgres.functions` to see what information is available to them.\n\nThis wiki has been written with myself in mind. While learning each of these\ndomains, I have been sensitive to the \"aha\" moments and have noted down my\ninsights as they arose. I have refrained from capturing information that I\nconsidered obvious or otherwise non-beneficial to my own understanding.\n\nThe ability I hope to gain from this wiki is the ability to step away from any\ngiven domain for a long period of time, and be able to be passably useful for\nwhatever my goals are within a short period of time. Of course, this is all\nvague sounding, and really depends on the domain, along with the ends I am\ntrying to reach.\n\nTo achieve this, the system should be steadfast to:\n- be able to put information in relatively easily, without too much thought\n\trequired to make that determination.\n- be able to extract the information that we need, meaning there is a\n\thigh-degree in confidence in the location of the information. The idea is\n\tthat information loses a large amount of its value when it is unfindable.\n\tTherefore, a relatively strict ideology should be used when determining\n\twhere a piece of information belongs.\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":3,"useFMTitle":true,"useNoteTitleForLink":true,"noLegacyNoteRef":true,"mermaid":true,"useKatex":true,"dev":{"enablePreviewV2":true},"site":{"assetsPrefix":"/Digital-Garden","siteUrl":"https://tycholiz.github.io","copyAssets":true,"siteHierarchies":["root"],"siteRootDir":"docs","usePrettyRefs":true,"title":"Dendron","description":"Publishable tech notes","duplicateNoteBehavior":{"action":"useVault","payload":["tech"]},"siteLastModified":true,"gh_edit_branch":"main","usePrettyLinks":true,"siteNotesDir":"notes","siteFaviconPath":"favicon.ico","gh_edit_link":true,"gh_edit_link_text":"Edit this page on GitHub","gh_root":"docs/","gh_edit_view_mode":"edit","writeStubs":true,"siteIndex":"root"},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{}},"workspace":{"dendronVersion":"0.67.1","vaults":[{"fsPath":"../main/tech","name":"tech"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"enableUserTags":true,"enableHashTags":true},"usePrettyRefs":true}},"__N_SSG":true}