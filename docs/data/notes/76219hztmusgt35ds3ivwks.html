<h1 id="context">Context<a aria-hidden="true" class="anchor-heading icon-link" href="#context"></a></h1>
<p>A Context allows us to manage the global state of a sub-tree of components</p>
<ul>
<li>ex. perhaps we have an ApplicationForm page with many fields, and we want to store that state in a form.</li>
</ul>
<p>If your goal with Context is only to avoid having to pass props down many levels, then consider using <a href="/notes/bXY3W37GW2ytFJOgbJiol">inversion of control</a> instead (bake those props into the component at the top level, then just pass the enhanced component itself down as a prop)</p>
<h2 id="components">Components<a aria-hidden="true" class="anchor-heading icon-link" href="#components"></a></h2>
<p>The React Context API consists of:</p>
<ul>
<li>The context</li>
<li>Provider</li>
<li>Consumer</li>
</ul>
<h3 id="the-context">The Context<a aria-hidden="true" class="anchor-heading icon-link" href="#the-context"></a></h3>
<p>This is the state. This is the part that becomes available to consumers under the provider</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// the type in the generic is the shape of the context state.</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">StagingNuggetContext</span> <span class="token operator">=</span> createContext<span class="token operator">&#x3C;</span>
  <span class="token keyword nil">undefined</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre>
<h3 id="provider">Provider<a aria-hidden="true" class="anchor-heading icon-link" href="#provider"></a></h3>
<p>The Provider is a component that wraps a subtree, allowing components lying underneath to consume the context state.</p>
<ul>
<li>it does this by taking a <code>value</code> prop which is the state (ie. the context) that will be made available to the consumers</li>
</ul>
<pre class="language-tsx"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">StagingNuggetContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span><span class="token class-name">StagingNuggetContext.Provider</span></span><span class="token punctuation">></span></span>
</code></pre>
<p>The state we pass to <code>value</code> is our underlying state-management mechanism.</p>
<ul>
<li>ex. we could use a simple <code>useState</code> hook for our context state-management, or we could get a little more complex and use <code>useReducer</code></li>
</ul>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">StagingNuggetProvider</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token maybe-class-name">StagingNuggetProviderProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">StagingNuggetContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span><span class="token class-name">StagingNuggetContext.Provider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="consumer">Consumer<a aria-hidden="true" class="anchor-heading icon-link" href="#consumer"></a></h3>
<p>A consumer is a component that subscribes to state from the context.</p>
<ul>
<li>A context may have many consumers</li>
</ul>
<p>All consumers that are descendants of a Provider will re-render whenever the Providerâ€™s value prop changes</p>
<h4 id="hook-optional">Hook (optional)<a aria-hidden="true" class="anchor-heading icon-link" href="#hook-optional"></a></h4>
<p>In the past, we would have made a <code>&#x3C;MyContext.Consumer></code> and wrapped any components that needed to access the context. In modern React, we can just use a hook to consume it:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useStagingNugget</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">StagingNuggetContext</span><span class="token punctuation">)</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>context <span class="token operator">===</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token string">'useStagingNugget must be used within a StagingNuggetProvider'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> context
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h3 id="how-re-renders-are-handled">How re-renders are handled<a aria-hidden="true" class="anchor-heading icon-link" href="#how-re-renders-are-handled"></a></h3>
<p>The updates to context values doesn't trigger re-render for all the children of the provider, rather only components that are rendered from within the Consumer</p>
<ul>
<li><a href="https://stackoverflow.com/questions/50817672/does-new-react-context-api-trigger-re-renders">source</a></li>
</ul>
<p>Context renders all consumers throughout the system on every change.</p>
<ul>
<li>In a larger scale app everything, the entire component tree, will render on every keystroke when you update an input field for instance</li>
</ul>
<h3 id="should-you-use-context">Should you use context?<a aria-hidden="true" class="anchor-heading icon-link" href="#should-you-use-context"></a></h3>
<p>If you need to make a couple of values that don't update often available to other components then context is what you want.</p>
<p>If you have non-trivial global state that updates frequently, requires complex updates and is used in lots of places then you should use a state management library (like <a href="/notes/l7V3v2ep1YdDCt7DOr7Ci">Redux</a> Zustand, or Jotai).</p>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/notes/59dedd99-adb7-430f-a849-b303425e3209">Hooks</a></li>
</ul>