<h1 id="ref">Ref<a aria-hidden="true" class="anchor-heading icon-link" href="#ref"></a></h1>
<h2 id="what-is-it">What is it?<a aria-hidden="true" class="anchor-heading icon-link" href="#what-is-it"></a></h2>
<p>A ref is a mutable value that is shared by all re-renders of a single component.</p>
<ul>
<li>Think of a ref as a piece of state that doesn't abide by the same re-rendering rules that apply to normal state.
<ul>
<li>normally this state controls imperative DOM elements, such as if an <code>&#x3C;input></code> is focused or not, or the current width of a resizable window.</li>
</ul>
</li>
<li>a ref can be a function or an object</li>
</ul>
<p>Refs are for when you want a component to "remember" some information, but you don’t want that information to trigger new renders.</p>
<ul>
<li>The <code>.current</code> value is like a secret pocket of your component that React doesn’t track. Therefore, it is an "escape hatch" from React's one-way data flow.</li>
</ul>
<p>The <code>useRef()</code> hook creates a mutable variable (ie. <code>ref.current</code>) inside a functional component that won’t update on every render.</p>
<p>When we attach a ref to a <code>&#x3C;div></code> element, we are creating a reference to that particular <code>&#x3C;div></code> element.</p>
<ul>
<li>under the hood, React automatically assigns the <code>current</code> property of the ref to the corresponding DOM node when the component renders.</li>
<li>once we have that reference to the JSX element, we can access properties and methods of the DOM node through the ref.
<ul>
<li>ex. if we attach a ref to a <code>&#x3C;div></code>, we can access the <code>innerText</code> property</li>
</ul>
</li>
</ul>
<p>With refs, we can also create a reference to another React component. To do this, the component to be referenced needs to use <code>forwardRef</code>, which allows us to forward the ref prop from a child component to a DOM element or a class or functional component.</p>
<h2 id="why-use-it">Why use it?<a aria-hidden="true" class="anchor-heading icon-link" href="#why-use-it"></a></h2>
<p>A ref should be used when:</p>
<ol>
<li>the "React-way" of interacting with children (ie. Passing props) doesn't cut it </li>
<li>we want to manually access DOM nodes or React elements created in the render method</li>
</ol>
<p>Traditionally, refs were meant to let you directly access an html element.</p>
<ul>
<li>ex. focus an input field</li>
<li>use refs To manage focus, text selection, or media playback</li>
</ul>
<p>When a piece of information is only needed by event handlers and changing it doesn’t require a re-render, using a ref may be more efficient.</p>
<h3 id="use-cases">Use-cases<a aria-hidden="true" class="anchor-heading icon-link" href="#use-cases"></a></h3>
<ul>
<li>Focus Management: Setting focus on an input field or a button programmatically, for example, in response to a specific user action.
<ul>
<li>ex. imagine we have a Parent component which renders 2 <code>&#x3C;input></code>. We want to enact the business logic that <em>upon filling out the first <code>&#x3C;input></code> and hitting enter, the second <code>&#x3C;input></code> should automatically be focused</em>.</li>
</ul>
</li>
<li>Integration with Non-React Libraries: When you need to incorporate third-party libraries that require direct DOM access or manipulation, refs can be useful.</li>
<li>Measurements: If you need to measure elements, like their width, height, or position, refs can be necessary.</li>
<li>Animations: While there are React libraries for animations, sometimes you might need to use refs for more granular control.</li>
</ul>
<h3 id="when-not-to-use-refs">When not to use Refs<a aria-hidden="true" class="anchor-heading icon-link" href="#when-not-to-use-refs"></a></h3>
<ul>
<li>Overusing for State Management: component state should be managed within the confines of React's prop and state system.
<ul>
<li>ex. using a ref to capture and validate an input value instead of utilizing the component's state and controlled components might be seen as not idiomatic.</li>
</ul>
</li>
<li>Bypassing React's Reconciliation: If refs are used to make direct DOM manipulations, like changing a node's text or toggling a class, instead of relying on React's re-render mechanism, it's probably a misuse. React works best when it's allowed to handle the DOM based on its state.</li>
<li>Mixing Logic: Mixing up business logic with direct DOM operations through refs can make the component harder to reason about, test, and maintain.</li>
<li>Overhead: Using too many refs can make a component overly complex, harder to read, and harder to maintain. If every other element has a ref attached, it's a red flag that the code might not be optimally structured.</li>
<li>Not Utilizing Available Abstractions: Sometimes developers use refs because they aren't aware of the higher-level abstractions available. 
<ul>
<li>ex. they might use a ref to set focus on an input field, unaware that some UI libraries provide components with built-in focus management.</li>
</ul>
</li>
</ul>
<h2 id="how-does-it-work">How does it work?<a aria-hidden="true" class="anchor-heading icon-link" href="#how-does-it-work"></a></h2>
<p>Imagine we had 2 counters: one made with state, and the other with refs. As expected, when we increment the state count, the component understands that it needs to re-render, so it does so and reads in the new value of count. When we increment the ref count however, the component understands that it should not update, so we end up still seeing the old value, even though underneath the hood, the count has still risen. Since nothing has caused the component to re-render, this value will remain static. Now imagine that we increment the state count. React will recognize that an updated state means that it needs to re-render the component. Upon doing so, the current value of the ref will be read.</p>
<ul>
<li>The variables created with <code>useRef()</code> persist in between component renders (like state).</li>
<li>The nature of refs is that we can change the value of the ref, and it will not cause the component to re-render.</li>
<li>Refs have a value called <code>.current()</code>, which gives us the value of the ref in the current rendering of the component.
<ul>
<li>this value is intentionally mutable</li>
</ul>
</li>
<li>Most elements inside of your document have a ref attribute, which facilitates the use of useRef to reference elements inside of your HTML.</li>
<li>refs created using createRef are not persisted between re-renders. A new ref is always created whenever the component is re-rendered.</li>
<li>Updating a ref value is considered a side effect</li>
</ul>
<p>This is the reason why you want to update your ref value in event handlers and effects and not during rendering</p>
<ul>
<li>ex. Imagine we have a list of users. When we click one, it logs out the username after 1 second. Now imagine that we click on a user, then click on another before the <code>console.log</code> occurs.
In this scenario, class components would log out user2, while functional components would log out user1.</li>
<li>This shows that functional components attach the call made to the user selected at the time. If we want to make a functional component that behaves like a class, we can use a ref, which is a value that is shared between all renders (in this sense it's sort of like an instance variable) &#x3C;-- (in retrospect I think this should read "static variable", since it exists across all renders, similar to how static variables exist across all instances of that class; however this information came from React docs)</li>
</ul>
<h3 id="forward-ref">Forward Ref<a aria-hidden="true" class="anchor-heading icon-link" href="#forward-ref"></a></h3>
<ul>
<li>What if we want to take a <strong>ref</strong> that is currently existing in the component and pass it down the tree?
<ul>
<li>ie. from <code>&#x3C;Parent /></code>, we can reference a component rendered by its <code>&#x3C;Child /></code></li>
<li>ex. we have <code>&#x3C;App /></code> and <code>&#x3C;Form /></code>. We have a <code>ref</code> defined in <code>App</code> and want to attach it to an input box inside <code>Form</code>. We wrap <code>Form</code> with <code>forwardRef</code>, enabling the component to receive the <code>ref</code> from <code>App</code>. in <code>Form</code>, we pass the ref to the input. Now, we can control that component from <code>App</code>.</li>
</ul>
</li>
<li>the component that has <code>forwardRef</code> in it is the component that is receiving the ref (ie. the child)</li>
<li><code>forwardRef()</code> will create a component, accepting 2 arguments: <code>props</code> and <code>ref</code> (a regular component just accepts props)</li>
</ul>
<h4 id="example">Example<a aria-hidden="true" class="anchor-heading icon-link" href="#example"></a></h4>
<p>Imagine we have a CheckoutPage component which renders a PaymentForm. The CheckoutPage handles all logic related to network calls in the app, and PaymentForm handles all form logic, including managing its own state. This is a reasonable separation of concerns. However, what happens if we want to access a piece of state in the parent from the child? Imagine the network call our parent made needed to get the address from the form. The "React Way" of accomplishing this is to bring the form state up one level to live in the parent component. However, this breaks our separation of concerns pattern. We can use an escape hatch forward ref in this circumstance.</p>
<p>Illustration:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">Parent</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> myRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Child</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>myRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">Child</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>myState<span class="token punctuation">,</span> setMyState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'This is my state!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function-variable function">getMyState</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span><span class="token keyword control-flow">return</span> myState<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>myState<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Then you should be able to get myState in the Parent component by calling: <code>myRef.current.getMyState()</code></p>
<h4 id="combined-ref">Combined ref<a aria-hidden="true" class="anchor-heading icon-link" href="#combined-ref"></a></h4>
<ul>
<li>for low-level UI development, it's common to want to use both a local ref and an external one (<code>forwardRef</code>).</li>
</ul>
<h3 id="useimperativehandle"><code>useImperativeHandle</code><a aria-hidden="true" class="anchor-heading icon-link" href="#useimperativehandle"></a></h3>
<p>This hooks lets us customize the ref (exposed via <code>forwardRef</code>) that is exposed to the parent who passed it.</p>
<ul>
<li>in other words, when a parent component renders a child component that accepts a ref, the child component can then choose to customize the values/methods that should be exposed to the parent.</li>
</ul>
<h4 id="use-case-1-limiting-methods-exposed-to-parent">Use case #1: limiting methods exposed to parent<a aria-hidden="true" class="anchor-heading icon-link" href="#use-case-1-limiting-methods-exposed-to-parent"></a></h4>
<ul>
<li>ex. imagine we had a <code>&#x3C;Parent /></code> and a <code>&#x3C;Child /></code>. The <code>&#x3C;Child /></code> renders an <code>&#x3C;input /></code>. From the <code>&#x3C;Parent /></code>, we define a ref and pass it to the <code>&#x3C;Child /></code>, because we want to imperatively control some of the <code>&#x3C;input /></code> methods from the <code>&#x3C;Parent /></code>. However, we don't need access to all the methods, so instead of attaching that forwarded ref directly to the <code>&#x3C;input /></code>, we use it to create an imperative handle (<code>useImperativeHandle</code>). Then, we create another ref (<code>inputRef</code>) in the <code>&#x3C;Child /></code> which gets attached to the <code>&#x3C;input /></code>, and we use that <code>inputRef</code> in the <code>useImperativeHandle</code>. The result is that two methods (<code>focus</code> and <code>scrollIntoView</code>) are exposed to the parent, instead of the whole reference to the <code>&#x3C;input /></code>.</li>
</ul>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token maybe-class-name">MyInput</span> <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyInput</span></span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        inputRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        inputRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>input</span> <span class="token spread"><span class="token punctuation">{</span><span class="token spread operator">...</span>props<span class="token punctuation">}</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="use-case-2-combining-the-methods-of-multiple-refs-into-one-function-call">Use case #2: Combining the methods of multiple refs into one function call<a aria-hidden="true" class="anchor-heading icon-link" href="#use-case-2-combining-the-methods-of-multiple-refs-into-one-function-call"></a></h4>
<ul>
<li>ex. Imagine we had a blog with a button which when clicked, would scroll the page down to the bottom of the comments list then highlight the <code>&#x3C;input /></code>. From our top-level component, we want to be able to just call <code>postRef.current.scrollAndFocusAddComment()</code>. From the child component, what we would do is define the <code>useImperativeHandle</code> which exposes that method, and define 2 more refs that get passed down to its children:</li>
</ul>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token maybe-class-name">Post</span> <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> commentsRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> addCommentRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token function">scrollAndFocusAddComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        commentsRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">scrollToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        addCommentRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">CommentList</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>commentsRef<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">AddComment</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>addCommentRef<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="uer">UER<a aria-hidden="true" class="anchor-heading icon-link" href="#uer"></a></h3>
<p><a href="https://overreacted.io/making-setinterval-declarative-with-react-hooks/">Dan Abramov on refs</a></p>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/notes/HBiP5GIRzCiKzuCXYODmn">useEffect</a></li>
</ul>