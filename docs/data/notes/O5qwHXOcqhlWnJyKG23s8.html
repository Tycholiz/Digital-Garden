<h1 id="prerendering">Prerendering<a aria-hidden="true" class="anchor-heading icon-link" href="#prerendering"></a></h1>
<p><code>getInitialProps</code> is the old way of handling SSR in Next.js. Now we use <code>getStaticProps</code> or <code>getServerSideProps</code>, depending on if we want SSG or SSR</p>
<p>There are 2 types of pre-rendering that Next offers:</p>
<ul>
<li>static generations - The <code>about</code> page is identical no matter who views that page. - Server-side rendering - HTML is generated by the server on each request.</li>
<li>Client-side rendering - as vanilla React does, we can still opt to use CSR if advantageous.</li>
</ul>
<p>In the browser devtools, we can find all of the props that are being sent from the server by filtering for <code>_next_data</code>. We can see the props object being passed in a <code>&#x3C;script /></code> tag.</p>
<ul>
<li>you can also filter the network requests by the same string to see the Nextjs requests that are made to get the props.</li>
</ul>
<h3 id="static-site-generation-ssg">Static Site Generation (SSG)<a aria-hidden="true" class="anchor-heading icon-link" href="#static-site-generation-ssg"></a></h3>
<p>The idea is "Why does the html need to be generated on the client, when we can leverage the server to do it beforehand? (ie. at build time)"</p>
<ul>
<li>this is the default, thus recommended option</li>
</ul>
<p>If your page shows frequently updated data, and the page content changes on every request, you <em>must</em> use SSR.</p>
<p>Statically generated pages can be cached by CDN</p>
<p>Examples:</p>
<ul>
<li>Marketing pages</li>
<li>Blog posts and portfolios</li>
<li>E-commerce product listings</li>
<li>Help and documentation</li>
</ul>
<h4 id="incremental-static-regeneration-isr">Incremental Static Regeneration (ISR)<a aria-hidden="true" class="anchor-heading icon-link" href="#incremental-static-regeneration-isr"></a></h4>
<p>By default, <code>getStaticProps</code> is run at build time.</p>
<p>However, sometimes we want to update static pages <em>after</em> we've built our site</p>
<p>With ISR, we can use static-generation on a per-page basis, without needing to rebuild the entire site</p>
<p>To do this, we add the <code>revalidate</code> prop to <code>getStaticProps()</code></p>
<p>If we set <code>revalidate</code> to <code>10</code> (seconds), a few things will happen:</p>
<ul>
<li>Any requests to the page after the initial request and before 10 seconds are also cached and instantaneous.</li>
<li>After the 10-second window, the next request will still show the cached (stale) page</li>
<li>Next.js triggers a regeneration of the page in the background.</li>
<li>Once the page generates successfully, Next.js will invalidate the cache and show the updated page. If the background regeneration fails, the old page would still be unaltered.</li>
</ul>
<h3 id="server-side-rendering-ssr">Server-Side Rendering (SSR)<a aria-hidden="true" class="anchor-heading icon-link" href="#server-side-rendering-ssr"></a></h3>
<p>Here, Next.js pre-renders a page on each request. It will be slower because the page cannot be cached by a CDN, but the pre-rendered page will always be up-to-date. </p>
<p>To use Server-side Rendering for a page, you need to export an async function called <code>getServerSideProps</code>. This function will be called by the server on every request.</p>
<h4 id="usage">Usage<a aria-hidden="true" class="anchor-heading icon-link" href="#usage"></a></h4>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Render data...</span>
<span class="token punctuation">}</span>

<span class="token comment">// This gets called on every request</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fetch data from external API</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&#x3C;URL></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword control-flow">await</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// Pass data to the page via props</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> props<span class="token operator">:</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token maybe-class-name">Page</span>
</code></pre>
<p>When you run <code>yarn build</code>, it generates 1 HTML document for every route on your site. Every side page, every blog post, every store item â€” an HTML file is created for each of them, ready to be served up immediately.</p>
<p><code>getServerSideProps</code> is run on every request</p>