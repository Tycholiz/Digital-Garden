<h1 id="expression">Expression<a aria-hidden="true" class="anchor-heading icon-link" href="#expression"></a></h1>
<p>Expressions are used to denote the attributes that you want to read from an item.</p>
<p>Expressions are strings that check for the validity of a particular statement.</p>
<p>With expressions, we can use comparator operators (<code>=</code>, <code>&#x3C;</code>, <code>></code>), as well as built-in functions like <code>attribute_exists()</code>, <code>contains()</code>, <code>size()</code> and <code>begins_with()</code></p>
<ul>
<li>ex. use <code>attribute_not_exists(DateShipped)</code> to ensure we are not updating an item that has already shipped.</li>
</ul>
<p>You also use expressions when writing an item to indicate any conditions that must be met, and to indicate how the attributes are to be updated.</p>
<p>By default, all items are returned with GET operations (like <code>GetItem</code>, <code>Query</code>, or <code>Scan</code>).</p>
<ul>
<li>to get only some items back, we use a <em>projection expression</em>, which is a string that identifies the attributes that you want.</li>
</ul>
<p>Expressions are used in a few different areas:</p>
<ul>
<li><em>condition expression</em> - update an item when certain conditions are true</li>
<li><em>projection expression</em> - specify a subset of attributes you want to receive when reading Items</li>
<li><em>update expression</em> - update a particular attribute in an existing Item.</li>
<li><em>key condition expression</em> - query a table with a composite primary key to limit the items selected.</li>
<li><em>filter expression</em> - filter the results of queries to make responses more efficient.</li>
</ul>
<p>Sometimes we cannot accurately represent our desired statement due to DynamoDB syntax limitations or when it's easier to use variable substitution to create the statement rather than building a string.</p>
<ul>
<li>we can use expression attribute names and expression attribute values to get around these limitations.</li>
<li>these allow you to define expression variables outside of the expression string itself, then use replacement syntax to use these variables in your expression.</li>
</ul>
<h3 id="expression-attribute-names">Expression attribute names<a aria-hidden="true" class="anchor-heading icon-link" href="#expression-attribute-names"></a></h3>
<p>An expression attribute name is a placeholder that you use in an DynamoDB expression</p>
<ul>
<li>begins with <code>#</code></li>
</ul>
<p>There are times where we want to write an expression for a particular attribute, but can't properly represent that attribute name due to DynamoDB limitations. These limitations are:</p>
<ul>
<li>the attribute is a <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/ReservedWords.html">reserved word</a></li>
<li>attribute name contains a <code>.</code></li>
<li>attribute name begins with a number</li>
</ul>
<p>To get around this, we pass in a map where the key is the placeholder to use in our expression and the value is the attribute name we want to expand to.</p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>
  <span class="token string-property property">"#ts"</span><span class="token operator">:</span> <span class="token string">"timestamp"</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Then, we can use <code>#a</code> when we want to refer to our <code>Age</code> attribute.</p>
<h3 id="expression-attribute-values">Expression attribute values<a aria-hidden="true" class="anchor-heading icon-link" href="#expression-attribute-values"></a></h3>
<p>These are substitutes for the actual values that you want to compareâ€” values that you might not know until runtime.</p>
<ul>
<li>begins with <code>:</code></li>
</ul>
<p>Similar to expression attribute names except that they are used for the values used to compare to values of attributes on an Item, rather than the name of the attribute.</p>
<ul>
<li>unlike expression attribute names, we must also specify the type:</li>
</ul>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><span class="token string-property property">":agelimit"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">"N"</span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre>
<p>For example, we could have a <code>scan</code> operation that returns us all items from the <code>ProductCatalog</code> table where the color is black and the size is less than $500:</p>
<pre class="language-sh"><code class="language-sh">aws dynamodb scan \
    --table-name ProductCatalog \
    --filter-expression "contains(Color, :c) and Price &#x3C;= :p" \
    --expression-attribute-values { \
        ":c": { "S": "Black" }, \
        ":p": { "N": "500" } \
      } \
    }
</code></pre>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/notes/gEztUcJYazBs8J8k0gi7o">DynamoDB</a></li>
</ul>