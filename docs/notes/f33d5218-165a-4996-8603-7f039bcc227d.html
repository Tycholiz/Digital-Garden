<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  
  <title>useEffect - Dendron</title>
  

  <link
    rel="shortcut icon"
    href="https://tycholiz.github.io/favicon.ico"
    type="image/x-icon"
  />
  <link
    rel="stylesheet"
    href="https://tycholiz.github.io/assets/css/just-the-docs-default.css"
  />
  <script
    type="text/javascript"
    src="https://tycholiz.github.io/assets/js/just-the-docs.js"
  ></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/themes/prism.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
    integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X"
    crossorigin="anonymous"
  />
  <script
    type="text/javascript"
    src="https://tycholiz.github.io/assets/js/vendor/lunr.min.js"
  ></script>
  
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   
  
<meta name="description" content="Personal knowledge space">
<meta name="author" content="">

<link rel="canonical" href="https://foo/notes/f33d5218-165a-4996-8603-7f039bcc227d.html">

<meta property="og:type" content="article">
<meta property="og:url" content="https://foo/notes/f33d5218-165a-4996-8603-7f039bcc227d.html">
<meta property="og:description" content="Personal knowledge space">
<meta property="og:image" content="https://fooundefined">

<meta name="twitter:card" content="summary">

<meta name="twitter:url" content="https://foo/notes/f33d5218-165a-4996-8603-7f039bcc227d.html">
<meta name="twitter:description" content="Personal knowledge space">
<meta name="twitter:image" content="https://fooundefined">


  <meta property="og:title" content="useEffect - Dendron" />
  <meta name="twitter:title" content="useEffect - Dendron" />
  
</head>


<body>
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <symbol id="svg-link" viewBox="0 0 24 24">
        <title>Link</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
      </symbol>
      <symbol id="svg-search" viewBox="0 0 24 24">
        <title>Search</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
          <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </symbol>
      <symbol id="svg-menu" viewBox="0 0 24 24">
        <title>Menu</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
          <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </symbol>
      <symbol id="svg-arrow-right" viewBox="0 0 24 24">
        <title>Expand</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </symbol>
      <symbol id="svg-doc" viewBox="0 0 24 24">
        <title>Document</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
          <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
        </svg>
      </symbol>
    </svg>

    <div class="side-bar">
      <div class="site-header">
        <a href="https://tycholiz.github.io" class="site-title lh-tight">
  Dendron

 </a>
        <a href="#" id="menu-button" class="site-button">
          <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
        </a>
      </div>

      <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
      </nav>
      <footer class="site-footer">
        üå± with üíï using <a href="https://www.dendron.so/"> Dendron üå≤ </a>
      </footer>
    </div>
    <div class="main" id="top">
        <div id="main-header" class="main-header">
          
            <div class="search">
              <div class="search-input-wrap">
                <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Dendron" aria-label="Search Dendron" autocomplete="off">
                <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
              </div>
              <div id="search-results" class="search-results"></div>
            </div>
          
          
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
      
        
          <nav aria-label="Breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="https://tycholiz.github.io">Root</a></li><li class="breadcrumb-nav-list-item"><a href="https://tycholiz.github.io/notes/b6226bd4-551d-4670-a956-158bdce3f5a6.html">React</a></li><li class="breadcrumb-nav-list-item"><a href="https://tycholiz.github.io/notes/734beb81-47b0-41b5-a964-fe05af534458.html">Lang</a></li><li class="breadcrumb-nav-list-item"><a href="https://tycholiz.github.io/notes/59dedd99-adb7-430f-a849-b303425e3209.html">Hooks</a></li><li class="breadcrumb-nav-list-item">useEffect</li></ol>
          </nav>
        
      
      <div id="main-content" class="main-content" role="main">

        
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

        

        <script>
          $(function () {
            $('[data-toggle="popover"]').popover({html: true})
          })
        </script>

        

<div id="main" role="main">

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="useEffect">
    
    <meta itemprop="datePublished" content="2021-03-06T14:35:13+00:00">
    <meta itemprop="dateModified" content="2021-04-08T09:52:24+00:00">

    <div class="page__inner-wrap">

      

      <section class="page__content" itemprop="text">

        

        <h1 id="useeffect"><a aria-hidden="true" class="anchor-heading" href="#useeffect"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>useEffect</h1>
<h1 id="useeffect-1"><a aria-hidden="true" class="anchor-heading" href="#useeffect-1"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>useEffect</h1>
<ul>
<li><em>The question is not ‚Äúwhen does this effect run‚Äù, the question is ‚Äúwith which state does this effect synchronize with:‚Äù</em>
<ul>
<li><code>useEffect(fn)</code> - all state</li>
<li><code>useEffect(fn, [])</code> - no state</li>
<li><code>useEffect(fn, [these, states])</code></li>
</ul>
</li>
<li>if one of the variables in the dependency array changes, <code>useEffect</code> runs again. If the array is empty the hook doesn't run when updating the component at all, because it doesn't have to watch any variables.</li>
<li>if you have no dependency array and are getting infinite loops, see if there are functions being defined each time in the component. It might be a simple fix to memoize them with <code>useCallback</code>
<ul>
<li>simply adding an empty dependency array is a bandaid solution and is not really addressing the root of the problem.</li>
</ul>
</li>
<li>By passing an empty array, we‚Äôre saying ‚Äúonly ever do this once‚Äù.
<ul>
<li>on rare occasions that‚Äôs ok, but most of the time you want something in there. The reason is that usually you want to synchronize with something in your code, not just perform the effect once</li>
</ul>
</li>
</ul>
<h2 id="shortcoming-of-useeffect"><a aria-hidden="true" class="anchor-heading" href="#shortcoming-of-useeffect"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Shortcoming of useEffect</h2>
<ul>
<li>Compared to class component lifecycle methods, the shortcoming of <code>useEffect</code> is that we while we can set new state, we are unable to access current state (because of stale closure)</li>
</ul>
<pre class="language-js"><code class="language-js"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> intervalId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>in this example, <code>count</code> is always pointing to the previous reference.</li>
<li>we can work around this shortcoming with refs. Essentially, because refs exist between renders, that value is never lost between mounts. We simply take the value from the ref, and update the state with that value:</li>
</ul>
<pre><code>useEffect(() => {
    const intervalId = setInterval(() => {
        countRef.current = countRef.current + 1
        setCount(countRef.current)
    }, 1000)
    return () => clearInterval(intervalId)
}, [])
</code></pre>
<p><code>this</code> is mutable state, and the problem with mutable state is that it is always up to date. The good thing about hooks in react is that there is no <code>this</code> get retrieve values from. State always stays the same within a given render of a component.</p><span id="navId" data="f33d5218-165a-4996-8603-7f039bcc227d"></span>

                
      </section>

      
    </div>

    
  </article>

  
  
</div>


        
          <hr>
          <footer>
            
            

            
                
              </div>
          </footer>
        
    </div>
</div>


  

  <div class="search-overlay"></div>

</div>
</body>
</html>
