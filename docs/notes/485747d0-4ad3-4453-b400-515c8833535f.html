<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  
  <title>Conf - Dendron</title>
  

  <link
    rel="shortcut icon"
    href="https://tycholiz.github.io/Digital-Garden/favicon.ico"
    type="image/x-icon"
  />
  <link
    rel="stylesheet"
    href="https://tycholiz.github.io/Digital-Garden/assets/css/just-the-docs-default.css"
  />
  <script
    type="text/javascript"
    src="https://tycholiz.github.io/Digital-Garden/assets/js/just-the-docs.js"
  ></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/themes/prism.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
    integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X"
    crossorigin="anonymous"
  />
  <script
    type="text/javascript"
    src="https://tycholiz.github.io/Digital-Garden/assets/js/vendor/lunr.min.js"
  ></script>
  
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   
  
<meta name="description" content="Personal knowledge space">
<meta name="author" content="">

<link rel="canonical" href="https://foo/notes/485747d0-4ad3-4453-b400-515c8833535f.html">

<meta property="og:type" content="article">
<meta property="og:url" content="https://foo/notes/485747d0-4ad3-4453-b400-515c8833535f.html">
<meta property="og:description" content="Personal knowledge space">
<meta property="og:image" content="https://fooundefined">

<meta name="twitter:card" content="summary">

<meta name="twitter:url" content="https://foo/notes/485747d0-4ad3-4453-b400-515c8833535f.html">
<meta name="twitter:description" content="Personal knowledge space">
<meta name="twitter:image" content="https://fooundefined">


  <meta property="og:title" content="Conf - Dendron" />
  <meta name="twitter:title" content="Conf - Dendron" />
  
</head>


<body>
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <symbol id="svg-link" viewBox="0 0 24 24">
        <title>Link</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
      </symbol>
      <symbol id="svg-search" viewBox="0 0 24 24">
        <title>Search</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
          <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </symbol>
      <symbol id="svg-menu" viewBox="0 0 24 24">
        <title>Menu</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
          <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </symbol>
      <symbol id="svg-arrow-right" viewBox="0 0 24 24">
        <title>Expand</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </symbol>
      <symbol id="svg-doc" viewBox="0 0 24 24">
        <title>Document</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
          <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
        </svg>
      </symbol>
    </svg>

    <div class="side-bar">
      <div class="site-header">
        <a href="https://tycholiz.github.io/Digital-Garden" class="site-title lh-tight">
  Dendron

 </a>
        <a href="#" id="menu-button" class="site-button">
          <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
        </a>
      </div>

      <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
      </nav>
      <footer class="site-footer">
        üå± with üíï using <a href="https://www.dendron.so/"> Dendron üå≤ </a>
      </footer>
    </div>
    <div class="main" id="top">
        <div id="main-header" class="main-header">
          
            <div class="search">
              <div class="search-input-wrap">
                <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Dendron" aria-label="Search Dendron" autocomplete="off">
                <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
              </div>
              <div id="search-results" class="search-results"></div>
            </div>
          
          
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
      
        
          <nav aria-label="Breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="https://tycholiz.github.io/Digital-Garden">Root</a></li><li class="breadcrumb-nav-list-item"><a href="https://tycholiz.github.io/Digital-Garden/notes/c299d2dd-7cbd-4b81-976a-37b808ee41a8.html">Nginx</a></li><li class="breadcrumb-nav-list-item">Conf</li></ol>
          </nav>
        
      
      <div id="main-content" class="main-content" role="main">

        
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

        

        <script>
          $(function () {
            $('[data-toggle="popover"]').popover({html: true})
          })
        </script>

        

<div id="main" role="main">

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Conf">
    
    <meta itemprop="datePublished" content="2021-03-30T22:38:14+00:00">
    <meta itemprop="dateModified" content="2021-03-30T22:38:42+00:00">

    <div class="page__inner-wrap">

      

      <section class="page__content" itemprop="text">

        

        <h1 id="conf"><a aria-hidden="true" class="anchor-heading" href="#conf"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Conf</h1>
<p>nginx.conf building blocks </p>
<ul>
<li>
<p>worker process    : should be equal to number cores of the server (or auto)</p>
</li>
<li>
<p>worker connection : 1024 (per thread. nginx doesn't block) </p>
</li>
<li>
<p>rate limiting     : prevent brute force attacks.</p>
</li>
<li>
<p>proxy buffers     : (when used as proxy server)limits how much data to store as cache
gzip /brotil or compression</p>
</li>
<li>
<p>upload file size  : it should match php max upload size and nginx client max body size.</p>
</li>
<li>
<p>timeouts          : php to nginx communication time.</p>
</li>
<li>
<p>log rotation      : error log useful to know the errors and monitor resources</p>
</li>
<li>
<p>fastcgi cache     : very important to boost the performance for static sties.</p>
</li>
<li>
<p>SSL Configuration : there are default setting available with nginx itself
(also see ssl performance tuning).</p>
</li>
</ul>
<p>Example nginx.conf: </p>
<pre><code>user www-data;                                   
load_module modules/my_favourite_module.so;      
pid /run/nginx.pid;
                                                    | Alternative global config for 
                                                    | [4 cores, 8 threads, 32GB RAM] 
                                                    | handling  50000request/sec
                                                    |
worker_processes auto;                           | worker_processes 8;
                                                    | worker_priority -15;
include /etc/nginx/modules-enabled/*.conf;       | 
worker_rlimit_nofile 100000;                     | worker_rlimit_nofile 400000;                                  
                                                    | timer_resolution 10000ms;
                                                    |
events {                                         | events {
    worker_connections 1024;                       |     worker_connections 20000;                       
    multi_accept on;                               |     use epoll;
}                                                |     multi_accept on;
                                                    | }

http {               ‚Üê  global config            
    index index.php index.html index.htm;          
    # Basic Settings                               

    sendfile on;                                   
    tcp_nopush on;
    tcp_nodelay on;
    sendfile_max_chunk 512;
    keepalive_timeout 300;
    keepalive_requests 100000;
    types_hash_max_size 2048;
    server_tokens off;

    server_names_hash_bucket_size 128;
    # server_name_in_redirect off;

    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    ##
    # SSL Settings
    ##

    #ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE
    #ssl_prefer_server_ciphers on;
    #rate limit zone

    limit_req_zone $binary_remote_addr zone=one:10m rate=3r/m;
    #buffers

    client_body_buffer_size 128k;
    client_max_body_size 10m;
    client_header_buffer_size 32k;
    large_client_header_buffers 16 256k;
    output_buffers 1 32k;
    postpone_output 1460;
    #Porxy buffers
    proxy_buffer_size 256k;
    proxy_buffers 8 128k;
    proxy_busy_buffers_size 256k;
    proxy_max_temp_file_size 2048m;
    proxy_temp_file_write_size 2048m;

    ## fast cgi PHP
    fastcgi_buffers 8 16k;
    fastcgi_buffer_size 32k;
    fastcgi_connect_timeout 300;
    fastcgi_send_timeout 300;
    fastcgi_read_timeout 300;
    #static caching css/js/img

    open_file_cache max=10000 inactive=5m;
    open_file_cache_valid 2m;
    open_file_cache_min_uses 1;
    open_file_cache_errors on;
    #timeouts

    client_header_timeout 3m;
    client_body_timeout 3m;
    send_timeout 3m;

    # Logging Settings

    log_format main_ext ‚Äò$remote_addr ‚Äì $remote_user [$time_local] ‚Äú$request‚Äù ‚Äò
    ‚Äò$status $body_bytes_sent ‚Äú$http_referer‚Äù ‚Äò
    ‚Äò‚Äù$http_user_agent‚Äù ‚Äú$http_x_forwarded_for‚Äù ‚Äò
    ‚Äò‚Äù$host‚Äù sn=‚Äù$server_name‚Äù ‚Äò
    ‚Äòrt=$request_time ‚Äò
    ‚Äòua=‚Äù$upstream_addr‚Äù us=‚Äù$upstream_status‚Äù ‚Äò
    ‚Äòut=‚Äù$upstream_response_time‚Äù ul=‚Äù$upstream_response_length‚Äù ‚Äò
    ‚Äòcs=$upstream_cache_status‚Äô ;

    #access_log /var/log/nginx/access.log main_ext;
    error_log /var/log/nginx/error.log warn;   Read more on nginx error log&#x26;common errors

    ##
    # Gzip Settings #brotil
    ##

    gzip on;
    gzip_disable ‚Äúmsie6‚Äù;

    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_buffers 16 8k;
    gzip_http_version 1.1;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript application/x-font-ttf font/opentype image/svg+xml image/x-icon;
    ##
    # Virtual Host Configs
    ##

    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;   
}

server {             ‚Üê Domain level 
    listen 0.0.0.0:443 rcvbuf=64000 sndbuf=120000 backlog=20000 ssl http2;
    server_name example.com www.example.com;
    keepalive_timeout         60;
    ssl                       on;
    ssl_protocols             TLSv1.2 TLSv1.1 TLSv1;
    ssl_ciphers               'ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS:!RC4';
    ssl_prefer_server_ciphers on;
    ssl_session_cache         shared:TLSSL:30m;
    ssl_session_timeout       10m;
    ssl_buffer_size           32k;
    ssl_certificate           /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key       /etc/letsencrypt/live/example.com/privkey.pem;
    ssl_dhparam           /etc/ssl/certs/dhparam.pem;
    more_set_headers          "X-Secure-Connection: true";
    add_header                Strict-Transport-Security max-age=315360000;
    root       /var/www;

    location {         ‚Üê Directory level 
        root /var/www;
        index index.php index.html;
    }

    location ~ .php$ {  
    fastcgi_keep_conn on;
    fastcgi_pass   unix:/run/php5.6-fpm.sock;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME /var/www$fastcgi_script_name;
    include fastcgi_params;
    fastcgi_intercept_errors off;
    fastcgi_buffer_size 32k;
    fastcgi_buffers 32 32k;
    fastcgi_connect_timeout 5;
    }

    location ~* ^.+.(jpg|jpeg|gif|png|svg|ico|css|less|xml|html?|swf|js|ttf)$ { 
        root /var/www;
        expires 10y;
    }

}
</code></pre>
<ul>
<li>/etc/nginx/conf.d/*: user defined config files</li>
</ul>
<p>See also:
<a href="https://github.com/trimstray/nginx-admins-handbook">https://github.com/trimstray/nginx-admins-handbook</a>
<a href="https://github.com/tldr-devops/nginx-common-configuration">https://github.com/tldr-devops/nginx-common-configuration</a></p><span id="navId" data="485747d0-4ad3-4453-b400-515c8833535f"></span>

                
      </section>

      
    </div>

    
  </article>

  
  
</div>


        
          <hr>
          <footer>
            
            

            
                
              </div>
          </footer>
        
    </div>
</div>


  

  <div class="search-overlay"></div>

</div>
</body>
</html>
