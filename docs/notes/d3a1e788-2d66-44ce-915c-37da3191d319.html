<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  
  <title>Promises - Dendron</title>
  

  <link
    rel="shortcut icon"
    href="https://tycholiz.github.io/code-notes/favicon.ico"
    type="image/x-icon"
  />
  <link
    rel="stylesheet"
    href="https://tycholiz.github.io/code-notes/assets/css/just-the-docs-default.css"
  />
  <script
    type="text/javascript"
    src="https://tycholiz.github.io/code-notes/assets/js/just-the-docs.js"
  ></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/themes/prism.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
    integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X"
    crossorigin="anonymous"
  />
  <script
    type="text/javascript"
    src="https://tycholiz.github.io/code-notes/assets/js/vendor/lunr.min.js"
  ></script>
  
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   
  
<meta name="description" content="Personal knowledge space">
<meta name="author" content="">

<link rel="canonical" href="https://foo/notes/d3a1e788-2d66-44ce-915c-37da3191d319.html">

<meta property="og:type" content="article">
<meta property="og:url" content="https://foo/notes/d3a1e788-2d66-44ce-915c-37da3191d319.html">
<meta property="og:description" content="Personal knowledge space">
<meta property="og:image" content="https://fooundefined">

<meta name="twitter:card" content="summary">

<meta name="twitter:url" content="https://foo/notes/d3a1e788-2d66-44ce-915c-37da3191d319.html">
<meta name="twitter:description" content="Personal knowledge space">
<meta name="twitter:image" content="https://fooundefined">


  <meta property="og:title" content="Promises - Dendron" />
  <meta name="twitter:title" content="Promises - Dendron" />
  
</head>


<body>
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <symbol id="svg-link" viewBox="0 0 24 24">
        <title>Link</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
      </symbol>
      <symbol id="svg-search" viewBox="0 0 24 24">
        <title>Search</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
          <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </symbol>
      <symbol id="svg-menu" viewBox="0 0 24 24">
        <title>Menu</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
          <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </symbol>
      <symbol id="svg-arrow-right" viewBox="0 0 24 24">
        <title>Expand</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </symbol>
      <symbol id="svg-doc" viewBox="0 0 24 24">
        <title>Document</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
          <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
        </svg>
      </symbol>
    </svg>

    <div class="side-bar">
      <div class="site-header">
        <a href="https://tycholiz.github.io/code-notes" class="site-title lh-tight">
  Dendron

 </a>
        <a href="#" id="menu-button" class="site-button">
          <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
        </a>
      </div>

      <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
      </nav>
      <footer class="site-footer">
        ðŸŒ± with ðŸ’• using <a href="https://www.dendron.so/"> Dendron ðŸŒ² </a>
      </footer>
    </div>
    <div class="main" id="top">
        <div id="main-header" class="main-header">
          
            <div class="search">
              <div class="search-input-wrap">
                <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Dendron" aria-label="Search Dendron" autocomplete="off">
                <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
              </div>
              <div id="search-results" class="search-results"></div>
            </div>
          
          
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
      
        
          <nav aria-label="Breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="https://tycholiz.github.io/code-notes">Root</a></li><li class="breadcrumb-nav-list-item"><a href="https://tycholiz.github.io/code-notes/notes/77ebb3d5-30b3-44e0-badc-02314bfd4f12.html">JavaScript</a></li><li class="breadcrumb-nav-list-item"><a href="https://tycholiz.github.io/code-notes/notes/4ac4398f-3812-4770-94c8-4877f5a98ca9.html">Lang</a></li><li class="breadcrumb-nav-list-item">Promises</li></ol>
          </nav>
        
      
      <div id="main-content" class="main-content" role="main">

        
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

        

        <script>
          $(function () {
            $('[data-toggle="popover"]').popover({html: true})
          })
        </script>

        

<div id="main" role="main">

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Promises">
    
    <meta itemprop="datePublished" content="2021-03-06T13:37:25+00:00">
    <meta itemprop="dateModified" content="2021-04-07T11:56:10+00:00">

    <div class="page__inner-wrap">

      

      <section class="page__content" itemprop="text">

        

        <h1 id="promises"><a aria-hidden="true" class="anchor-heading" href="#promises"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Promises</h1>
<h1 id="promises-1"><a aria-hidden="true" class="anchor-heading" href="#promises-1"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Promises</h1>
<p>using promises effectively factors time out of the picture.</p>
<ul>
<li>In other words, it is abstracted away</li>
<li>ex. race conditions</li>
</ul>
<p>An asynchronous function returns a promise immediately, so the client isnâ€™t blocked</p>
<p>There are 2 sides to promises: the <code>executor</code> (the one doing the actions) and the <code>consumer</code> (the one waiting for the actions to be done so it can consume the result.
Executor ex. (resolve, reject) =>
Consumer ex. .then, .catch, .finally</p>
<ul>
<li>executor is usually defined as part of a library, so it's not often that we write this code</li>
</ul>
<p>Executor gets run as soon as it's defined. Therefore, its state will either be resolved or rejected</p>
<p>Think of <code>.then</code>, <code>.catch</code> and <code>.finally</code> as the way that consumers subscribe to the executor</p>
<p><code>.then</code> appears only on promises</p>
<p><code>.then</code> is analogous to adding another "fan" onto the subscription mailing list</p>
<p>A executor sends its material (the data) with resolve(stuff)
A consumer receives it with .then(stuff)</p>
<p><code>promise.then</code> returns a promise</p>
<p>spec:when we wrap a function in <code>Promise(..)</code>, we are promisifying it</p>
<ul>
<li>The new function that returns this promisified function now returns a Promise that resolves to its original return value</li>
</ul>
<p>The return value from a .then() method becomes the resolved value of the promise (and gets fed into the next .then() if there is one)</p>
<p>Think of async actions atomically, and make each step a .then() that returns the input for the next .then()
Ex. First .then() returns the JSON data as an obj, second returns a subset of that data, third acts on it</p>
<p>(Inside promises) if a promise is returned (eg. return Promise.resolve('stuff')), the next .then() will execute only when that promise has resolved (with 'stuff').
If the return value is anything else besides a promise, then it will be passed immediately to the next .then()</p>
<p>.resolve(value)
If the value passed to it is a promise itself, this will automatically "follow" that promise chain and wait to pass back the final resolved value.</p>
<ul>
<li>Good to use if you are unsure if a value is a promise or not</li>
</ul>
<p>Promise.all is a server at a restaurant waiting to bring everyone's food at the same time, even though one meal may be ready before the others</p>
<h2 id="promises-are-only-ever-resolved-once-per-creation"><a aria-hidden="true" class="anchor-heading" href="#promises-are-only-ever-resolved-once-per-creation"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Promises are only ever resolved once per creation</h2>
<ul>
<li>In the following code it seems that we would connect to the database 2 times, but Promises don't work like that.</li>
<li>since <code>databasePromise</code> is only defined one time, it can by definition only resolve one time.</li>
</ul>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> databasePromise <span class="token operator">=</span> <span class="token function">connectDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> booksPromise <span class="token operator">=</span> databasePromise
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span>findAllBooks<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userPromise <span class="token operator">=</span> databasePromise
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span>getCurrentUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  booksPromise<span class="token punctuation">,</span>
  userPromise
<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> books <span class="token operator">=</span> values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token function">pickTopRecommentations</span><span class="token punctuation">(</span>books<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="sleep-example"><a aria-hidden="true" class="anchor-heading" href="#sleep-example"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Sleep example</h2>
<ul>
<li>We can use promises make a function who's purpose is to simply wait, before executing further code. We define it as such:</li>
</ul>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ms</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li>as soon as we call <code>sleep(1000)</code>, a promise is returned to us. This means that javascript will say "ok, since we're waiting on that promise to resolve (or reject), I'm going to go do some other stuff, and once your promise resolves, I'll be back to execute the <code>.then()</code> code". Once
<ul>
<li>This is precicely why promises are said to "handle asynchronous things synchronously". It is because promises help us manage 2 different lines of execution at a time</li>
</ul>
</li>
</ul>
<h2 id="async-await"><a aria-hidden="true" class="anchor-heading" href="#async-await"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Async await</h2>
<ul>
<li>every function annotated with async returns an implicit promise
<ul>
<li><em>"The async function declaration defines an asynchronous function, which returns an AsyncFunction object. An asynchronous function is a function which operates asynchronously via the event loop, using an implicit Promise to return its result."</em></li>
</ul>
</li>
<li>spec: every time we see <code>await</code>, it means the promise must resolve before moving on.</li>
</ul>
<h3 id="top-level-await"><a aria-hidden="true" class="anchor-heading" href="#top-level-await"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Top-level Await</h3>
<ul>
<li>Top-level await allows us to use await outside of a function marked <code>async</code>
<ul>
<li>It acts like a big async function causing other modules who import them to wait before they start evaluating their body.</li>
</ul>
</li>
<li>In the latest ECMAScript, we can run <code>await</code> at the top level</li>
</ul><span id="navId" data="d3a1e788-2d66-44ce-915c-37da3191d319"></span>

                
      </section>

      
    </div>

    
  </article>

  
  
</div>


        
          <hr>
          <footer>
            
            

            
                
              </div>
          </footer>
        
    </div>
</div>


  

  <div class="search-overlay"></div>

</div>
</body>
</html>
